[2025-04-17 08:50:23] Ошибка обработки файла: invalid literal for int() with base 10: '97AD'

[2025-04-20 10:19:51] ❌ Ошибка обработки файла: D:\data\2020\10_18.json
Traceback (most recent call last):
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 534, in _make_request
    response = conn.getresponse()
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 516, in getresponse
    httplib_response = super().getresponse()
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1430, in getresponse
    response.begin()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 331, in begin
    version, status, reason = self._read_status()
                              ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 300, in _read_status
    raise RemoteDisconnected("Remote end closed connection without"
                             " response")
http.client.RemoteDisconnected: Remote end closed connection without response

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\clickhouse_connect\driver\httpclient.py", line 449, in _raw_request
    response = self.http.request(method, url, **kwargs)
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\_request_methods.py", line 143, in request
    return self.request_encode_body(
           ~~~~~~~~~~~~~~~~~~~~~~~~^
        method, url, fields=fields, headers=headers, **urlopen_kw
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\_request_methods.py", line 278, in request_encode_body
    return self.urlopen(method, url, **extra_kw)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\poolmanager.py", line 443, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\retry.py", line 474, in increment
    raise reraise(type(error), error, _stacktrace)
          ~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\util\util.py", line 38, in reraise
    raise value.with_traceback(tb)
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 534, in _make_request
    response = conn.getresponse()
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 516, in getresponse
    httplib_response = super().getresponse()
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1430, in getresponse
    response.begin()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 331, in begin
    version, status, reason = self._read_status()
                              ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 300, in _read_status
    raise RemoteDisconnected("Remote end closed connection without"
                             " response")
urllib3.exceptions.ProtocolError: ('Connection aborted.', RemoteDisconnected('Remote end closed connection without response'))

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\win11\Projects\fpds\insert_json_clickhouse.py", line 172, in process_data_and_insert
    insert_batch_with_retry(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        client, "raw_contracts", batch, columns, file_id)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\win11\Projects\fpds\insert_json_clickhouse.py", line 50, in insert_batch_with_retry
    client.insert(table, batch, column_names=columns)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\clickhouse_connect\driver\client.py", line 624, in insert
    context = self.create_insert_context(table,
                                         column_names,
    ...<3 lines>...
                                         column_oriented,
                                         settings)
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\clickhouse_connect\driver\client.py", line 723, in create_insert_context
    describe_result = self.query(f'DESCRIBE TABLE {full_table}')
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\clickhouse_connect\driver\client.py", line 228, in query
    return self._query_with_context(query_context)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\clickhouse_connect\driver\httpclient.py", line 239, in _query_with_context
    response = self._raw_request(body,
                                 params,
    ...<3 lines>...
                                 fields=fields,
                                 server_wait=not context.streaming)
  File "C:\Users\win11\AppData\Local\Programs\Python\Python313\Lib\site-packages\clickhouse_connect\driver\httpclient.py", line 461, in _raw_request
    raise OperationalError(f'Error {ex} executing HTTP request attempt {attempts}{err_url}') from ex
clickhouse_connect.driver.exceptions.OperationalError: Error ('Connection aborted.', RemoteDisconnected('Remote end closed connection without response')) executing HTTP request attempt 2 (http://localhost:8123)

================================================================================
